name: Run HubSpot to Dialpad Sync

on:
  schedule:
    - cron: '0 0 * * *' # Every day at 00:00 UTC â†’ 10:00 AEST (adjust as needed)
  workflow_dispatch: # allows you to run it manually from GitHub UI

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: 3.10

      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Load Config File
        run: |
          echo "Using config.env for secrets"
        env:
          HUBSPOT_API_KEY: ${{ secrets.HUBSPOT_API_KEY }}
          DIALPAD_COOLBEANS_API_KEY: ${{ secrets.DIALPAD_COOLBEANS_API_KEY }}
          DIALPAD_COMPANY_ID: ${{ secrets.DIALPAD_COMPANY_ID }}

      - name: Write config.env
        run: |
          echo "HUBSPOT_API_KEY=${{ secrets.HUBSPOT_API_KEY }}" >> config.env
          echo "DIALPAD_COOLBEANS_API_KEY=${{ secrets.DIALPAD_COOLBEANS_API_KEY }}" >> config.env
          echo "DIALPAD_COMPANY_ID=${{ secrets.DIALPAD_COMPANY_ID }}" >> config.env
          echo "SYNC_SCHEDULE=Daily" >> config.env  # GitHub Action will always use Daily

      - name: Run Sync Script
        run: python hubspot_sync.py
